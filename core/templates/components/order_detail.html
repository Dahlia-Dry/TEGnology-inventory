{% load tags %}
{% load static %}
<style>
    .progress-bar-vertical {
    width: 10px;
    height: 100%;
    transform: rotate(180deg);
    background: #d0cece;
    display: -webkit-box;  
    display: -ms-flexbox;  
    display: -webkit-flex; 
    display: flex;      
    align-items: flex-end;
    -webkit-align-items: flex-end;
    }

    .progress-bar-vertical .progress-bar {
    width: 100%;
    height: 0;
    -webkit-transition: height 0.6s ease;
    -o-transition: height 0.6s ease;
    transition: height 0.6s ease;
    background-color: #bc2a1a;
    }
</style>
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 id='order-name' class="h2">{{selected_order.name}}</h1>
    <div class="btn-toolbar" role="toolbar">
        <div class="btn-group px-1">
            <a class='edit-order' id='edit-order' href="/orders/id={{selected_order.pipedrive_id}}/edit_meta" data-popup-url="/orders/id={{selected_order.pipedrive_id}}/edit_meta"><button type="button" class="btn btn-sm btn-outline-secondary"><span data-feather="edit-3"></span> Edit Order Metadata</button></a>
        </div>
    </div>
</div> 
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
    <h4 class="h6" id="order-status">status: {{selected_order.get_status}} &nbsp;<i>{{selected_order.status_date}}</i></h4>
    <div class="btn-toolbar" role="toolbar">
        <div class="btn-group px-1">
            <a class='edit-status' id='edit-status' href="/orders/id={{selected_order.pipedrive_id}}/edit_status" data-popup-url="/orders/id={{selected_order.pipedrive_id}}/edit_status"><button type="button" class="btn btn-sm btn-outline-secondary"><span data-feather="clock"></span> Update Order Status</button></a>
        </div>
    </div>
</div> 

{{purchases|safe}}
<div class="container py-3">
    <div class="row">
        <div class="col" >
            <div class="progress flex-row-reverse progress-bar-vertical">
                <div class="progress-bar progress-striped" role="progressbar" aria-valuenow="{{progress_percent}}" aria-valuemin="0" aria-valuemax="100" style="height: {{progress_percent}}%;">
                </div>
              </div>
        </div>
        <div class="col-11">
            {% for filetype, file_obj in files.items %}
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-1 mb-1">
                <h1 class="h2">{{filetype|title}}</h1>
                {% if selected_order|get_attr:filetype is not None %}
                <div class="btn-toolbar" role="toolbar">
                    <div class="btn-group px-1">
                        <a href="/orders/id={{selected_order.pipedrive_id}}/{{filetype}}" target="_blank"><button type="button" class="btn btn-sm btn-outline-secondary"><span data-feather="eye"></span> View File</button></a>
                    </div>
                    <div class="btn-group px-1">
                        <form method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="form_id" value="delete_file">
                            <input type="hidden" name="filetype" value="{{filetype}}">
                            <input type="hidden" name ="pk" id="pk" value="{{selected_order.pipedrive_id}}">
                            <button type="submit" class="btn btn-sm btn-outline-danger"><span data-feather="trash"></span> Delete file</button>
                        </form>
                    </div>
                </div>
            </div>
                {% if file_obj.sent_date is None %}
            <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="form_id" value="set_date">
                <input type="hidden" name="filetype" value="{{filetype}}">
                <input type="hidden" name ="pk" id="pk" value="{{selected_order.pipedrive_id}}">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
                    {% with form=file_form|key:filetype %}
                    {{form.as_p}}
                    {% endwith %}
                    <div class="btn-toolbar" role="toolbar">
                        <div class="btn-group px-1">
                            <button type="submit" class="btn btn-sm btn-outline-success"><span data-feather="send"></span> Mark as Sent</button>
                        </div>
                    </div>
                </div>
            </form>
            {% else %}
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
                <h4 class="h6" id="order-status">sent date: {{file_obj.sent_date}}</h4>
                <div class=class="btn-toolbar" role="toolbar">
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="form_id" value="undo_set_date">
                        <input type="hidden" name="filetype" value="{{filetype}}">
                        <input type="hidden" name ="pk" id="pk" value="{{selected_order.pipedrive_id}}">
                        <div class="btn-group px-1">
                            <button type="submit" class="btn btn-sm btn-outline-secondary"><span data-feather="rotate-ccw"></span> Undo Mark as Sent</button>
                        </div>
                    </form>
                </div>
            </div>
            {% endif %}
                {% else %}
                <div class="btn-toolbar" role="toolbar">
                    <div class="btn-group px-1">
                        <a href="/orders/id={{selected_order.pipedrive_id}}/{{filetype}}/generate"><button type="button" class="btn btn-sm btn-outline-secondary"><span data-feather="file-plus"></span> Generate</button></a>
                    </div>
                </div>
                {% endif %} 
            {% endfor %}
        </div>
    </div>
</div>


<div class="modal fade" id="editOrderModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <form method="POST" class="modal-content">
            {% csrf_token %}
            <input type="hidden" name="form_id" value="edit_order_meta">
            <div class="modal-header">
              <h5 class="modal-title">Edit Order Data</h5>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
              <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-sm btn-outline-success">Save</button>
            </div>
        </form>
      </div>
</div>
</div>
<div class="modal fade" id="editStatusModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <form method="POST" class="modal-content">
            {% csrf_token %}
            <input type="hidden" name="form_id" value="edit_order_status">
            <div class="modal-header">
              <h5 class="modal-title">Edit Order Status</h5>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
              <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-sm btn-outline-success">Save</button>
            </div>
        </form>
      </div>
</div>
</div>